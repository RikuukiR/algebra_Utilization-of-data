\usepackage{amsmath}
\usepackage{ascmac}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{latexsym}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{empheq}
\usepackage{amssymb}
\usepackage[dvipdfmx]{graphicx}
\usepackage{tikz}
\usepackage{textcomp}
\usepackage{enumitem}
\usepackage[most]{tcolorbox}
\usepackage[dvipdfmx]{xcolor}
\usepackage{environ}
\usepackage{etoolbox}
\usepackage{needspace}
\usetikzlibrary{intersections,calc,arrows.meta}

% è¡Œé–“ã‚’å°‘ã—åºƒã’ã‚‹
\linespread{1.15}

% åˆ†æ•°ã‚’å¸¸ã«å¤§ããè¡¨ç¤º
\everymath{\displaystyle}

% æ•°å¼ç’°å¢ƒå‰å¾Œã®ç©ºç™½ã‚’èª¿æ•´ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–‹å§‹æ™‚ã«é©ç”¨ï¼‰
\AtBeginDocument{%
  \setlength{\abovedisplayskip}{1pt}%
  \setlength{\belowdisplayskip}{6pt}%
  \setlength{\abovedisplayshortskip}{1pt}%
  \setlength{\belowdisplayshortskip}{3pt}%
}

% åˆ†æ•°ã‚³ãƒãƒ³ãƒ‰ã‚’å†å®šç¾©ï¼ˆåˆ†å­ã¨åˆ†æ¯ã®ä¸¡ç«¯ã«0.5æ–‡å­—åˆ†ã®ç©ºç™½ã‚’è¿½åŠ ï¼‰
% å…ƒã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿å­˜
\let\oldfrac\frac
\let\olddfrac\dfrac
% å†å®šç¾©ï¼ˆ\, ã¯0.5æ–‡å­—åˆ†ã®ç©ºç™½ï¼‰
\renewcommand{\frac}[2]{\oldfrac{\,#1\,}{\,#2\,}}
\renewcommand{\dfrac}[2]{\olddfrac{\,#1\,}{\,#2\,}}

% å¹³å‡è¨˜å·ã®ãƒãƒ¼ã‚’é•·ãã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
\newcommand{\mean}[1]{\overline{#1}}

% æ·»å­—å†…ã§ä½¿ã†ä½™äº‹è±¡ã®è¡¨è¨˜ï¼ˆå°åˆ·æ™‚ã‚‚è¦‹ã‚„ã™ã„ã‚ˆã†ã«å°‘ã—å¤ªã‚ã®ãƒãƒ¼ï¼‰
\newcommand{\comp}[1]{\bar{#1}}

% åˆ†æ•°ã®ç©´åŸ‹ã‚ã‚³ãƒãƒ³ãƒ‰ï¼ˆä¸‹ç·šãªã—ï¼‰
% åˆ†æ•°ç”¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆè¡¨å°‚ç”¨ - åˆ†å­ã‚’ç©ºæ¬„ã«ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒï¼‰
\newcommand{\fracblank}[2]{%
  \ifshowanswer
    \textcolor{blue}{\frac{\,#1\,}{\,#2\,}}%  è§£ç­”ç‰ˆï¼šé’è‰²
  \else
    \frac{\,\phantom{#1}\,}{\,#2\,}%  ç©ºæ¬„ç‰ˆï¼šåˆ†å­ã‚’é€æ˜åŒ–, ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒ
  \fi
}

% enumerateç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼ˆå•é¡Œç’°å¢ƒç­‰ã§ä½¿ç”¨ï¼‰
\setlist[enumerate,1]{label=ï¼ˆ\arabic*ï¼‰, leftmargin=*, labelsep=0.5em}
\setlist[enumerate,2]{label=ï¼ˆ\alph*ï¼‰, leftmargin=*, labelsep=0.5em}
\setlist[enumerate,3]{label=ï¼ˆ\roman*ï¼‰, leftmargin=*, labelsep=0.5em}

% itemizeç’°å¢ƒã‚’æ•°å­¦ã®å ´åˆåˆ†ã‘ç”¨ï¼ˆï¼ˆâ…°ï¼‰, ï¼ˆâ…±ï¼‰å½¢å¼ï¼‰ã«è¨­å®š
\newcounter{itemizecounter}
\makeatletter
\renewenvironment{itemize}{%
  \setcounter{itemizecounter}{0}%
  \begin{list}{}{%
    \setlength{\leftmargin}{2.5em}%
    \setlength{\labelsep}{0.5em}%
    \setlength{\itemindent}{0em}%
    \def\makelabel##1{%
      \stepcounter{itemizecounter}%
      \hss\llap{ï¼ˆ\roman{itemizecounter}ï¼‰}%
    }%
  }%
}{%
  \end{list}%
}
\makeatother

\usepackage[normalem]{ulem} % ä¸‹ç·šç”¨
\usepackage{stackengine} % è¿½åŠ 

% ä¸¸å›²ã¿æ–‡å­—ã‚³ãƒãƒ³ãƒ‰
\newcommand{\ctext}[1]{\raise0.2ex\hbox{\textcircled{\scriptsize{#1}}}}

% å®šç†ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆæœ€å¾Œã®ãƒ”ãƒªã‚ªãƒ‰ã‚’å‰Šé™¤ï¼‰
\newtheoremstyle{myplain}
  {3pt}   % Space above
  {3pt}   % Space below
  {\itshape}  % Body font
  {}  % Indent amount
  {\bfseries} % Theorem head font
  {}  % Punctuation after theorem head (ç©ºã«ã—ã¦ãƒ”ãƒªã‚ªãƒ‰ã‚’å‰Šé™¤)
  {.5em}  % Space after theorem head
  {}  % Theorem head spec

\newtheoremstyle{mydefinition}
  {3pt}   % Space above
  {3pt}   % Space below
  {}  % Body font
  {}  % Indent amount
  {\bfseries} % Theorem head font
  {}  % Punctuation after theorem head (ç©ºã«ã—ã¦ãƒ”ãƒªã‚ªãƒ‰ã‚’å‰Šé™¤)
  {.5em}  % Space after theorem head
  {}  % Theorem head spec

\theoremstyle{mydefinition}
\newtheorem{definition}{Definition}
\newtheorem*{definition*}{Definition}
\theoremstyle{myplain}
\newtheorem{theorem}{Theorem}
\newtheorem*{theorem*}{Theorem}

% è¨¼æ˜ç’°å¢ƒã‚’å†å®šç¾©ï¼ˆè¨¼æ˜ç’°å¢ƒå†…ã®æœ€å¾Œã«5è¡Œã®ç©ºè¡Œã‚’è¿½åŠ ã€â–¡ã®å‰ã€ãƒšãƒ¼ã‚¸ã‚’è·¨ãŒãªã„ã‚ˆã†ã«ï¼‰
\makeatletter
\renewenvironment{proof}[1][\proofname]{\par
  \needspace{8\baselineskip}%  è¨¼æ˜ç’°å¢ƒå…¨ä½“ãŒ1ãƒšãƒ¼ã‚¸ã«åã¾ã‚‹ã‚ˆã†ã«å¿…è¦ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿
  \pushQED{\qed}%
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
        \itshape
    #1\@addpunct{.}]\ignorespaces
}{%
  \par\vspace*{5\baselineskip}%  è¨¼æ˜ç’°å¢ƒå†…ã®è§£ç­”æ¬„ç¢ºä¿ã®ãŸã‚5è¡Œã®ç©ºè¡Œã‚’è¿½åŠ ï¼ˆâ–¡ã®å‰ï¼‰
  \popQED\endtrivlist\@endpefalse
}
\makeatother

% ========================================
% å•é¡Œç’°å¢ƒã®è¨­å®š
% ========================================
% å•é¡Œç•ªå·ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆå˜ç´”ãªé€£ç•ª: 1, 2, 3, ...ï¼‰
\newcounter{problemcounter}
\renewcommand{\theproblemcounter}{\arabic{problemcounter}}

% å•é¡Œç’°å¢ƒï¼ˆæ ãªã—, ã‚·ãƒ³ãƒ—ãƒ«ï¼‰
\newenvironment{problem}[1][\relax]{%
  \refstepcounter{problemcounter}%
  \vspace{2em}%
  \noindent%
  \textbf{å•é¡Œ\theproblemcounter}%
  \ifx#1\relax\else~\textbf{#1}\fi%
  \par\vspace{0.8em}%
  \noindent%
}{%
  \par\vspace{2em}%
}

% å•é¡Œç’°å¢ƒï¼ˆæ ä»˜ãï¼‰
\newenvironment{problembox}[1][\relax]{%
  \refstepcounter{problemcounter}%
  \vspace{2em}%
  \begin{itembox}[l]{\textbf{å•é¡Œ\theproblemcounter}%
  \ifx#1\relax\else~\textbf{#1}\fi}%
}{%
  \end{itembox}%
  \vspace{1.5em}%
}

% ä¾‹é¡Œç’°å¢ƒï¼ˆæ ä»˜ãï¼‰- ã€ã€‘å†…ã®ç•ªå·ã‚’ä½¿ç”¨
\newenvironment{example}[1][\relax]{%
  \vspace{2em}%
  \begin{itembox}[l]{\textbf{ä¾‹é¡Œ}%
  \ifx#1\relax\else~\textbf{#1}\fi}%
}{%
  \end{itembox}%
  \vspace{1.5em}%
}

% ç·´ç¿’å•é¡Œç’°å¢ƒï¼ˆæ ä»˜ãï¼‰- ã€ã€‘å†…ã®ç•ªå·ã‚’ä½¿ç”¨
\newenvironment{exercise}[1][\relax]{%
  \vspace{2em}%
  \begin{itembox}[l]{\textbf{ç·´ç¿’å•é¡Œ}%
  \ifx#1\relax\else~\textbf{#1}\fi}%
}{%
  \end{itembox}%
  \vspace{1.5em}%
}

% è§£ç­”ç’°å¢ƒ
\newenvironment{solution}{%
  \vspace{1em}%
  \noindent%
  \ifshowanswer%
    \textbf{ã€è§£ç­”ã€‘}\\%
  \fi%
}{%
  \par\vspace{1em}%
}

% å•é¡Œå°‚ç”¨ã®è§£ç­”ç’°å¢ƒï¼ˆå¸¸ã«ç©ºæ¬„, æ‰‹æ›¸ãã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ï¼‰
% ä½¿ã„æ–¹: \begin{problemsolution}[é«˜ã•] ... \end{problemsolution}
% ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé«˜ã•ã¯15cm
% â€»æœ€å¾Œã®ç©ºç™½ã¯æ‰‹å‹•ã§ \vspace{5\baselineskip} ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
% ç©ºæ¬„æ™‚: è§£ç­”å†…å®¹ã‚’ç™½è‰²ã§å‡ºåŠ›ã—, è¨¼æ˜çµ‚äº†è¨˜å·ï¼ˆâ–¡ï¼‰ã‚’åŒã˜ä½ç½®ã«é…ç½®
\NewEnviron{problemsolution}[1][15cm]{%
  \begin{proof}\mbox{}\\%
  \ifshowanswer%
    {\color{blue}\BODY}%
  \else%
    {\color{white}\BODY}%
  \fi%
  \end{proof}%
}

% åˆ¥è§£ç’°å¢ƒï¼ˆè§£ç­”è¡¨ç¤ºæ™‚ã®ã¿è¡¨ç¤º, ãƒ”ãƒªã‚ªãƒ‰ãªã—ï¼‰
\NewEnviron{altproof}{%
  \ifshowanswer%
    \par\vspace{1em}%
    \noindent\textbf{ã€åˆ¥è§£ã€‘}\par%
    {\color{blue}\BODY\par\hfill$\square$}%
    \vspace{1em}%
  \fi%
}

% ========================================
% è§£ç­”è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆè¨­å®š
% ========================================
% è§£ç­”ã‚’è¡¨ç¤ºã—ãŸã„å ´åˆï¼š\showanswertrue
% è§£ç­”ã‚’éš ã—ãŸã„å ´åˆï¼š\showanswerfalse
\newif\ifshowanswer
% ã“ã“ã‚’ \showanswertrue ã«å¤‰æ›´ã™ã‚‹ã¨è§£ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
\showanswertrue
% ç©´åŸ‹ã‚ã‚³ãƒãƒ³ãƒ‰ã®ä¿®æ­£ç‰ˆï¼ˆupLaTeXå¯¾å¿œï¼‰
\newcommand{\Blank}[2][3cm]{%
  ~%
  \ifshowanswer
    \stackon[1pt]{\uline{\makebox[#1][l]{\hphantom{ã‚}}}}{{\normalsize\sffamily #2}}%
  \else
    \uline{\makebox[#1][l]{\hphantom{ã‚}}}%
  \fi
  ~%
}

% æ­£è§£ã«åˆã‚ã›ã¦è‡ªå‹•ã§ç©ºæ¬„ã‚’ä½œã‚‹ï¼ˆemå˜ä½ç‰ˆï¼‰
% ä½¿ç”¨æ³•: \fitblank[ç­”ãˆ]{å¹…} ã¾ãŸã¯ \fitblank{å¹…}ï¼ˆç­”ãˆãªã—ã®å ´åˆï¼‰
% å¤ªæ–‡å­—ç‰ˆ: \fitblankbf[ç­”ãˆ]{å¹…}
% ä¸‹ç·šã®ä¸¡ç«¯ã«1æ–‡å­—åˆ†ã®ç©ºç™½ã‚’è¿½åŠ 
\newcommand{\fitblank}[2][\relax]{%
  \ifx#1\relax
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼ˆå¾“æ¥ã®ä½¿ç”¨æ³•ï¼‰
    \hspace{1em}\underline{\hspace*{#2em}}\hspace{1em}%
  \else
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
    \ifshowanswer
      \hspace{1em}\underline{\makebox[#2em][c]{#1}}\hspace{1em}%
    \else
      \hspace{1em}\underline{\hspace*{#2em}}\hspace{1em}%
    \fi
  \fi
}

% å¤ªæ–‡å­—ç‰ˆã®ç©ºæ¬„ã‚³ãƒãƒ³ãƒ‰ï¼ˆç­”ãˆã¯é’è‰²ã§è¡¨ç¤ºï¼‰
% ä¸‹ç·šã®ä¸¡ç«¯ã«1æ–‡å­—åˆ†ã®ç©ºç™½ã‚’è¿½åŠ 
\newcommand{\fitblankbf}[2][\relax]{%
  \ifx#1\relax
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼ˆå¾“æ¥ã®ä½¿ç”¨æ³•ï¼‰
    \hspace{1em}\underline{\hspace*{#2em}}\hspace{1em}%
  \else
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
    \ifshowanswer
      \hspace{1em}\underline{\makebox[#2em][c]{\textcolor{blue}{\textbf{#1}}}}\hspace{1em}%
    \else
      \hspace{1em}\underline{\hspace*{#2em}}\hspace{1em}%
    \fi
  \fi
}

% æ•°å¼ã¨æ–‡å­—ã®ä¸¡æ–¹ã‚’å¤ªå­—ã«ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
\newcommand{\fitblankbold}[2][\relax]{%
  \ifx#1\relax
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼ˆå¾“æ¥ã®ä½¿ç”¨æ³•ï¼‰
    \underline{\hspace*{#2em}}%
  \else
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
    \ifshowanswer
      \underline{\makebox[#2em][c]{\boldmath\textbf{#1}}}%
    \else
      \underline{\hspace*{#2em}}%
    \fi
  \fi
}

% ========================================
% tcolorboxç’°å¢ƒï¼ˆèƒŒæ™¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŒºåˆ¥ï¼‰
% ========================================

% å®šç¾©ç’°å¢ƒï¼ˆèµ¤ç³»ï¼šè–„ã„èµ¤èƒŒæ™¯ + èµ¤æ ï¼‰- è‡ªå‹•ç•ªå·ä»˜ã
% æ³¨: #1ã¯ãƒ©ãƒ™ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰, #2ã¯ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¿…é ˆï¼‰
\newtcolorbox{definitionbox}[2][]{
    enhanced,
    colback=red!5,
    colframe=red!70!black,
    boxrule=0.8pt,
    sharp corners,
    left=10pt, right=10pt, top=8pt, bottom=8pt,
    fonttitle=\bfseries,
    code={\refstepcounter{definition}\if\relax\detokenize{#1}\relax\else\label{#1}\fi}, % #1ãŒç©ºã§ãªã„å ´åˆã®ã¿ãƒ©ãƒ™ãƒ«è¨­å®š
    title={Definition \thedefinition\if\relax\detokenize{#2}\relax\else\quad\textbf{#2}\fi}
}

% å®šç†ç’°å¢ƒï¼ˆé’ç³»ï¼šè–„ã„é’èƒŒæ™¯ + é’æ ï¼‰- è‡ªå‹•ç•ªå·ä»˜ã
% æ³¨: #1ã¯ãƒ©ãƒ™ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰, #2ã¯ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¿…é ˆï¼‰
\newtcolorbox{theorembox}[2][]{
    enhanced,
    colback=blue!5,
    colframe=blue!70!black,
    boxrule=1pt,
    sharp corners,
    left=10pt, right=10pt, top=8pt, bottom=8pt,
    fonttitle=\bfseries,
    code={\refstepcounter{theorem}\if\relax\detokenize{#1}\relax\else\label{#1}\fi}, % #1ãŒç©ºã§ãªã„å ´åˆã®ã¿ãƒ©ãƒ™ãƒ«è¨­å®š
    title={Theorem \thetheorem\if\relax\detokenize{#2}\relax\else\quad\textbf{#2}\fi}
}

% å•é¡Œç’°å¢ƒï¼ˆæ¿ƒã„ç°è‰²èƒŒæ™¯ + å¤ªç·šï¼‰
\newtcolorbox{problembox2}[1][]{
    enhanced,
    colback=black!10,
    colframe=black,
    boxrule=1.2pt,
    sharp corners,
    left=10pt, right=10pt, top=8pt, bottom=8pt,
    fonttitle=\bfseries,
    title=#1
}

% ========================================
% ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ç’°å¢ƒï¼ˆç·‘ç³»ï¼šè–„ã„ç·‘èƒŒæ™¯ + ç·‘æ ï¼‰
% ========================================
\newcounter{technique}
\newtcolorbox{techniquebox}[2][]{
    enhanced,
    colback=green!5,
    colframe=green!70!black,
    boxrule=0.8pt,
    sharp corners,
    left=10pt, right=10pt, top=8pt, bottom=8pt,
    fonttitle=\bfseries,
    code={\refstepcounter{technique}\if\relax\detokenize{#1}\relax\else\label{#1}\fi},
    title={Technique \thetechnique\if\relax\detokenize{#2}\relax\else\quad\textbf{#2}\fi}
}

% ========================================
% ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰ï¼ˆæ•°å¼ç’°å¢ƒå†…ã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰
% ========================================
% ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼ˆæ•°å¼å†…æ¨å¥¨ï¼‰
\newcommand{\tech}[1]{%
    \textcolor{green!60!black}{\textit{ï¼ˆ#1ï¼‰}}%
}

% å¼·èª¿ç‰ˆï¼ˆé€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆç”¨ï¼‰
\newcommand{\technique}[1]{%
    \textcolor{green!70!black}{\textbf{ã€ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã€‘}} #1%
}

% èƒŒæ™¯è‰²ä»˜ãç‰ˆï¼ˆç›®ç«‹ãŸã›ãŸã„å ´åˆï¼‰
\newcommand{\tip}[1]{%
    \colorbox{yellow!20}{\textcolor{orange!70!black}{\textbf{ğŸ’¡}} #1}%
}

% ========================================
% æ‰‹æ›¸ãç”¨ç©ºæ¬„ã‚³ãƒãƒ³ãƒ‰ï¼ˆä¸‹ç·šãªã—, ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ï¼‰
% ========================================

% è§£ç­”ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ã®è¡¨ç¤º/éè¡¨ç¤º
% ä½¿ã„æ–¹: \answerblock{è§£ç­”å†…å®¹}
\newcommand{\answerblock}[1]{%
  \ifshowanswer
    \textcolor{blue}{#1}%  è§£ç­”ã‚’é’è‰²ã§è¡¨ç¤º
  \else
    % ç©ºæ¬„æ™‚ã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
  \fi
}

% ========================================
% answerç”¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåŸºæº–ã¯ç­”ãˆã®å¹…, ç©ºæ¬„æ™‚ã‚‚å¹…ã‚’ç¢ºä¿ï¼‰
% ========================================

% ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”¨ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ»æ•°å¼ä¸¡ç”¨ï¼‰
% ä½¿ã„æ–¹: \answertext{ç­”ãˆ}
% ç©ºæ¬„æ™‚: ç­”ãˆã®å¹… + ä¸¡ç«¯ã«3emï¼ˆ3æ–‡å­—åˆ†ï¼‰ã®ä½™ç™½ï¼ˆæ‰‹æ›¸ãç”¨ï¼‰
\newcommand{\answertext}[1]{%
  \ifshowanswer
    \textcolor{blue}{#1}%  è§£ç­”ã‚’é’è‰²ã§è¡¨ç¤ºï¼ˆä¸‹ç·šãªã—ï¼‰
  \else
    \uline{\hspace{3em}\phantom{#1}\hspace{3em}}%  ç©ºæ¬„æ™‚ã¯ç­”ãˆã®å¹… + ä¸¡ç«¯3emï¼ˆæ‰‹æ›¸ãç”¨ï¼‰+ é»’ã®ä¸‹ç·š
  \fi
}

% æ•°å¼ãƒ–ãƒ­ãƒƒã‚¯ç”¨ï¼ˆalignç’°å¢ƒãªã©å†…éƒ¨ã§ä½¿ç”¨ï¼‰
% ä½¿ã„æ–¹: \answermath{æ•°å¼}
% ç©ºæ¬„æ™‚: ç­”ãˆã®å¹… + ä¸¡ç«¯ã«4emï¼ˆ4æ–‡å­—åˆ†ï¼‰ã®ä½™ç™½ï¼ˆæ‰‹æ›¸ãç”¨ï¼‰
\newcommand{\answermath}[1]{%
  \ifshowanswer
    {\color{blue}#1}%  æ•°å¼ã‚’é’è‰²ã§è¡¨ç¤ºï¼ˆä¸‹ç·šãªã—ï¼‰
  \else
    \underline{\hspace{4em}\phantom{#1}\hspace{4em}}%  ç©ºæ¬„æ™‚ã¯ç­”ãˆã®å¹… + ä¸¡ç«¯4emï¼ˆæ‰‹æ›¸ãç”¨ï¼‰+ é»’ã®ä¸‹ç·š
  \fi
}

% alignç’°å¢ƒå…¨ä½“ã‚’è§£ç­”è¡¨ç¤ºæ©Ÿèƒ½ã®å¯¾è±¡ã«ã™ã‚‹ç’°å¢ƒ
% ä½¿ã„æ–¹: \begin{alignanswer*} ... \end{alignanswer*}
% ç©ºæ¬„æ™‚: å‰å¾Œã«ç©ºç™½ã‚’è¿½åŠ ï¼ˆæ‰‹æ›¸ãç”¨ï¼‰
\NewEnviron{alignanswer*}{%
  \ifshowanswer
    \begingroup
    \color{blue}%
    \begin{align*}
      \BODY
    \end{align*}%
    \endgroup
  \else
    \vspace{1em}%
    \begingroup
    \color{white}%
    \begin{align*}
      \BODY
    \end{align*}%
    \endgroup
    \vspace{1em}%
  \fi
}

% è¡¨å°‚ç”¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆç©ºæ¬„ã«ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒï¼‰
% ä½¿ã„æ–¹: \answertable{ç­”ãˆ}
% ç©ºæ¬„ç‰ˆï¼šé€æ˜åŒ–ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒ
\newcommand{\answertable}[1]{%
  \ifshowanswer
    \textcolor{blue}{#1}%  è§£ç­”ç‰ˆï¼šé’è‰²ã§è¡¨ç¤º
  \else
    \phantom{#1}%  ç©ºæ¬„ç‰ˆï¼šé€æ˜åŒ–, ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒ
  \fi
}

% ========================================
% blankç”¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆè§£ç­”æ™‚ã‚‚ä½™ç™½ã‚ã‚Šç‰ˆï¼‰
% â€»é€šå¸¸ã¯ answerç”¨ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
% ========================================

% ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”¨ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ»æ•°å¼ä¸¡ç”¨ï¼‰
% ä½¿ã„æ–¹: \blanktext{ç­”ãˆ}
% è§£ç­”æ™‚ãƒ»ç©ºæ¬„æ™‚ã¨ã‚‚: ç­”ãˆã®å¹… + ä¸¡ç«¯ã«0.5emç©ºç™½
\newcommand{\blanktext}[1]{%
  \ifshowanswer
    \hspace{0.5em}\textcolor{blue}{#1}\hspace{0.5em}%
  \else
    \uline{\hspace{0.5em}\phantom{#1}\hspace{0.5em}}%  ç©ºæ¬„æ™‚ã¯é»’ã®ä¸‹ç·šä»˜ã
  \fi
}

% æ•°å¼ãƒ–ãƒ­ãƒƒã‚¯ç”¨ï¼ˆalignç’°å¢ƒãªã©å†…éƒ¨ã§ä½¿ç”¨ï¼‰
% ä½¿ã„æ–¹: \blankmath{æ•°å¼}
% è§£ç­”æ™‚ãƒ»ç©ºæ¬„æ™‚ã¨ã‚‚: ç­”ãˆã®å¹… + å·¦1.5em, å³2.5emç©ºç™½
\newcommand{\blankmath}[1]{%
  \ifshowanswer
    \hspace{1.5em}{\color{blue}#1}\hspace{2.5em}%
  \else
    \hspace{1.5em}\phantom{#1}\hspace{2.5em}%
  \fi
}

% æ‰‹æ›¸ãã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ç‰ˆï¼ˆæŒ‡å®šã—ãŸé«˜ã•ã®ç©ºç™½ã‚’ä½œã‚‹ï¼‰
% ä½¿ã„æ–¹: \answerspace[é«˜ã•]{è§£ç­”å†…å®¹}
% é«˜ã•ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯5cm
\newcommand{\answerspace}[2][5cm]{%
  \ifshowanswer
    \textcolor{blue}{#2}%  è§£ç­”ã‚’é’è‰²ã§è¡¨ç¤º
  \else
    \vspace{#1}%  æŒ‡å®šã—ãŸé«˜ã•ã®ç©ºç™½ã‚’ç¢ºä¿
  \fi
}

% æ—¢å­˜ã®é’è‰²ç©ºæ¬„ã‚³ãƒãƒ³ãƒ‰ï¼ˆä¸‹ç·šä»˜ãç‰ˆã‚‚è¿½åŠ ï¼‰
% é’è‰²ç‰ˆã® fitblank
\newcommand{\fitblankblue}[2][\relax]{%
  \ifx#1\relax
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆ
    \underline{\hspace*{#2em}}%
  \else
    % ç­”ãˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
    \ifshowanswer
      \textcolor{blue}{\underline{\makebox[#2em][c]{#1}}}%
    \else
      \underline{\hspace*{#2em}}%
    \fi
  \fi
}

% é’è‰²å¤ªæ–‡å­—ç‰ˆ
\newcommand{\fitblankbfblue}[2][\relax]{%
  \ifx#1\relax
    \underline{\hspace*{#2em}}%
  \else
    \ifshowanswer
      \textcolor{blue}{\underline{\makebox[#2em][c]{\textbf{#1}}}}%
    \else
      \underline{\hspace*{#2em}}%
    \fi
  \fi
}

% åˆ†æ•°ã®é’è‰²ç‰ˆ
% åˆ†æ•°ç”¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆè¡¨å°‚ç”¨ - åˆ†å­ã‚’ç©ºæ¬„ã«ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒï¼‰
\newcommand{\fracblankblue}[2]{%
  \ifshowanswer
    \textcolor{blue}{\frac{\,#1\,}{\,#2\,}}%  è§£ç­”ç‰ˆï¼šé’è‰²
  \else
    \frac{\,\phantom{#1}\,}{\,#2\,}%  ç©ºæ¬„ç‰ˆï¼šåˆ†å­ã‚’é€æ˜åŒ–, ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿æŒ
  \fi
}
